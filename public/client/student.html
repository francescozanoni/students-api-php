<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Getting started with JSON Form</title>
    <link href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII="
          rel="icon" type="image/x-icon"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="style.css"/>
</head>
<body>

<nav class="navbar navbar-default navbar-static-top">
    <div class="container">
        <a class="navbar-brand" href="#">Students management</a>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-4">
            <h3>Details</h3>
            <dl></dl>
        </div>
        <div class="col-md-8">
            <h3>Annotations</h3>
            <table id="annotations" class="display compact"></table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h3>Internships</h3>
            <table id="internships" class="display compact"></table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8">
            <h3>Eligibilities</h3>
            <table id="eligibilities" class="display compact"></table>
        </div>
        <div class="col-md-4">
            <h3>OSH course attendances</h3>
            <table id="osh_course_attendances" class="display compact"></table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h3>Educational activity attendances</h3>
            <table id="educational_activity_attendances" class="display compact"></table>
        </div>
    </div>
</div>

<script src="https://unpkg.com/jsonform@2.1.6/deps/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap.min.js"></script>
<script>

    $(document).ready(function () {

        var studentId = window.location.hash.substr(1);

        $.get("/students/" + studentId)
            .done(function (data, textStatus, jqXHR) {
                delete data.data.id;
                Object.keys(data.data)
                    .forEach(key => $(".container .row dl").append("<div><dt>" + key + "</dt><dd>" + data.data[key] + "</dd></div>"));
            })
            .fail(function (jqXHR, textStatus, error) {
                console.error(error);
            });

        $('#annotations').DataTable({
            ajax: {
                url: "/students/" + studentId + "/annotations?with_audits=true",
                method: "GET",
                cache: true
            },
            paging: false,
            searching: false,
            ordering: false,
            info: false,
            columns: [
                {title: "ID", data: "id", visible: false},
                {title: "Date/time", data: "audits.0.created_at"},
                {title: "Title", data: "title"},
                {title: "Content", data: "content"}
            ]
        });

        $('#internships').DataTable({
            ajax: {
                url: "/students/" + studentId + "/internships",
                method: "GET",
                cache: true
            },
            paging: false,
            searching: false,
            ordering: false,
            info: false,
            columns: [
                {title: "ID", data: "id", visible: false},
                {title: "Start", data: "start_date"},
                {title: "End", data: "end_date"},
                {title: "Location", data: "location"},
                {title: "Ward", data: "sub_location"},
                {title: "Hour amount", data: "hour_amount"},
                {title: "Other amount", data: "other_amount"},
                {title: "Is optional", data: "is_optional"},
                {title: "Is interrupted", data: "is_interrupted"}
            ]
        });

        $('#eligibilities').DataTable({
            ajax: {
                url: "/students/" + studentId + "/eligibilities",
                method: "GET",
                cache: true
            },
            paging: false,
            searching: false,
            ordering: false,
            info: false,
            columns: [
                {title: "ID", data: "id", visible: false},
                {title: "Start", data: "start_date"},
                {title: "End", data: "end_date"},
                {title: "Is eligible", data: "is_eligible"},
                {title: "Notes", data: "notes"},
            ]
        });

        $('#osh_course_attendances').DataTable({
            ajax: {
                url: "/students/" + studentId + "/osh_course_attendances",
                method: "GET",
                cache: true
            },
            paging: false,
            searching: false,
            ordering: false,
            info: false,
            columns: [
                {title: "ID", data: "id", visible: false},
                {title: "Start", data: "start_date"},
                {title: "End", data: "end_date"}
            ]
        });

        $('#educational_activity_attendances').DataTable({
            ajax: {
                url: "/students/" + studentId + "/educational_activity_attendances",
                method: "GET",
                cache: true
            },
            paging: false,
            searching: false,
            ordering: false,
            info: false,
            columns: [
                {title: "ID", data: "id", visible: false},
                {title: "Start", data: "start_date"},
                {title: "End", data: "end_date"},
                {title: "Educational activity", data: "educational_activity"},
                {title: "Credits", data: "credits"},
            ]
        });

    });
</script>
</body>
</html>